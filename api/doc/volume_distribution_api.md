# 成交量分布分析 API 文档

## 接口概述

该 API 用于分析某个交易日的成交量分布情况，提供 Top N 股票成交量占比和多种集中度指标，帮助评估市场资金的集中程度和分布特征。

## 接口信息

- **URL**: `/api/volume-distribution`
- **方法**: `GET`
- **Content-Type**: `application/json`

## 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| trade_date | String | 是 | 交易日期，格式 YYYYMMDD | 20240101 |
| top_n | Integer | 否 | 返回 Top N 股票详情，默认 50 | 100 |

## 请求示例

```bash
# 查询 2024年1月1日的成交量分布（默认返回 Top 50）
GET http://localhost:8000/api/volume-distribution?trade_date=20240101

# 查询并返回 Top 100 股票详情
GET http://localhost:8000/api/volume-distribution?trade_date=20240101&top_n=100
```

## 响应数据结构

```json
{
  "success": true,
  "data": {
    "trade_date": "20240101",
    "total_volume": 12345678900.0,
    "total_amount": 987654321000.0,
    "total_stocks": 5000,
    "top_concentrations": {
      "top10_pct": 0.25,
      "top30_pct": 0.45,
      "top50_pct": 0.58,
      "top100_pct": 0.72
    },
    "concentration_metrics": {
      "hhi": 850.5,
      "hhi_level": "低集中度",
      "gini_coefficient": 0.6234,
      "gini_level": "高度不均",
      "cr4": 15.8,
      "cr8": 22.3,
      "entropy": 5.2341
    },
    "top_stocks": [
      {
        "rank": 1,
        "ts_code": "600519.SH",
        "volume": 123456789.0,
        "amount": 9876543210.0,
        "volume_pct": 1.0,
        "amount_pct": 1.0,
        "pct_chg": 2.5
      }
    ]
  }
}
```

## 响应字段说明

### 基础信息

| 字段 | 类型 | 说明 |
|------|------|------|
| trade_date | String | 分析日期 |
| total_volume | Float | 总成交量（手） |
| total_amount | Float | 总成交额（元） |
| total_stocks | Integer | 股票总数 |

### Top N 成交量占比 (top_concentrations)

| 字段 | 类型 | 说明 |
|------|------|------|
| top10_pct | Float | Top 10 股票成交量占总成交量的百分比（0-1） |
| top30_pct | Float | Top 30 股票成交量占总成交量的百分比（0-1） |
| top50_pct | Float | Top 50 股票成交量占总成交量的百分比（0-1） |
| top100_pct | Float | Top 100 股票成交量占总成交量的百分比（0-1） |

**应用场景**：
- **结构性行情**：Top10 占比高，但 Top100 占比不高，说明热点集中在少数龙头股
- **全面行情**：Top10 占比适中，Top100 占比高，说明普涨格局
- **市场活跃度**：占比越分散，说明市场参与度越高

### 成交量集中度指标 (concentration_metrics)

#### 1. HHI (赫芬达尔-赫希曼指数)

| 字段 | 类型 | 说明 |
|------|------|------|
| hhi | Float | HHI 指数值（0-10000） |
| hhi_level | String | 集中度等级 |

**判断标准**：
- **< 1500**: 低集中度（市场竞争充分）
- **1500-2500**: 中等集中度
- **> 2500**: 高集中度（市场较为集中）

**含义**：所有股票市场份额的平方和，衡量市场集中程度。值越大表示成交量越集中在少数股票上。

**应用**：
- 监测市场垄断程度
- 评估市场流动性风险
- 识别资金过度集中的风险信号

#### 2. Gini Coefficient (基尼系数)

| 字段 | 类型 | 说明 |
|------|------|------|
| gini_coefficient | Float | 基尼系数（0-1） |
| gini_level | String | 不均衡等级 |

**判断标准**：
- **< 0.3**: 相对均匀（成交量分布较为均衡）
- **0.3-0.5**: 中等不均
- **> 0.5**: 高度不均（成交量分布极不均衡）

**含义**：衡量成交量分布的不均衡程度。0 表示完全均衡，1 表示完全不均衡。

**应用**：
- 评估市场公平性
- 识别市场结构变化
- 判断资金分布是否健康

#### 3. CR4/CR8 (集中度比率)

| 字段 | 类型 | 说明 |
|------|------|------|
| cr4 | Float | 前 4 名股票成交量占比（百分比） |
| cr8 | Float | 前 8 名股票成交量占比（百分比） |

**判断标准**：
- **CR4 > 50%**: 高度集中
- **CR4 30-50%**: 中度集中
- **CR4 < 30%**: 较为分散

**应用**：
- 快速判断龙头股影响力
- 评估板块轮动情况
- 识别主力资金动向

#### 4. Entropy (熵指数)

| 字段 | 类型 | 说明 |
|------|------|------|
| entropy | Float | 熵指数值 |

**含义**：衡量成交量分布的混乱程度。值越小表示越集中，值越大表示越分散。

**应用**：
- 衡量市场多样性
- 评估市场不确定性
- 辅助判断市场阶段

### Top 股票详情 (top_stocks)

| 字段 | 类型 | 说明 |
|------|------|------|
| rank | Integer | 排名 |
| ts_code | String | 股票代码 |
| volume | Float | 成交量（手） |
| amount | Float | 成交额（元） |
| volume_pct | Float | 成交量占比（百分比） |
| amount_pct | Float | 成交额占比（百分比） |
| pct_chg | Float? | 涨跌幅（可选） |

## 实战应用场景

### 1. 市场阶段判断

#### 牛市特征
- HHI 较低（< 1500）
- Gini 系数适中（0.3-0.5）
- 成交量分散到更多股票
- Top100 占比高，说明普涨格局

#### 熊市特征
- HHI 较高（> 2500）
- Gini 系数高（> 0.5）
- 成交量集中在少数股票
- Top10 占比显著高于 Top100

#### 结构性行情
- CR4/CR8 较高
- Top10 占比高，但 Top100 占比不高
- 说明热点集中在少数龙头股

### 2. 风险评估

#### 高风险信号
- HHI > 2500（高度集中）
- Gini > 0.6（极度不均）
- CR4 > 50%（龙头垄断）
- 可能预示市场流动性风险

#### 健康市场
- HHI < 1500（竞争充分）
- Gini < 0.4（相对均衡）
- CR4 < 30%（分散交易）
- 市场参与度高，流动性好

### 3. 择时参考

#### 买入信号
- 成交量从集中转向分散
- HHI 下降，Gini 系数下降
- Top100 占比上升
- 说明市场情绪转暖，资金入场

#### 卖出信号
- 成交量从分散转向集中
- HHI 上升，Gini 系数上升
- Top10 占比快速上升
- 可能预示市场情绪转冷

### 4. 板块轮动分析

通过对比不同交易日的数据：
- **CR4/CR8 变化**：龙头股影响力变化
- **Top N 占比变化**：资金流向变化
- **熵指数变化**：市场多样性变化

## 错误响应

### 日期格式错误

```json
{
  "success": false,
  "error": "日期格式错误，应为 YYYYMMDD"
}
```

### 无数据

```json
{
  "success": false,
  "error": "交易日 20240101 没有数据"
}
```

## 使用建议

1. **定期监测**：建议每日收盘后分析当日成交量分布
2. **趋势分析**：对比多日数据，观察集中度指标的变化趋势
3. **结合其他指标**：配合市场情绪、技术指标等综合判断
4. **关注极值**：当指标出现极端值时，需要特别警惕
5. **行业对比**：可以按行业分析，发现板块轮动机会

## 技术说明

### 计算方法

1. **HHI**: Σ(市场份额²) × 10000
2. **Gini**: 基于洛伦兹曲线计算的不均衡指数
3. **CR**: 前 N 名市场份额之和
4. **Entropy**: -Σ(份额 × ln(份额))

### 性能优化

- 数据库查询已优化，按成交量降序排列
- 计算过程使用向量化操作
- 支持缓存机制，提升响应速度

### 数据来源

- 数据来源：`stock_daily` 表
- 更新频率：每日收盘后更新
- 数据质量：经过清洗和验证

## 版本历史

- **v1.0.0** (2024-12-11): 初始版本，提供完整的成交量分布分析功能
